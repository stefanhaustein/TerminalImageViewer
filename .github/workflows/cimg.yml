name: Update CIMG.h
env:
  file: "CImg.h"
on:
  release:
    types: [published]
  workflow_dispatch:
jobs:
  pull-file:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/github-script@v7
        id: get-cimg
        env:
          latest-tag: ${{ steps.latest-tag.outputs.result }}
        with:
          result-encoding: string
          script: |
              github.rest.repos.getContent({
                owner: 'GreycLab', repo: 'CImg', path: 'CImg.h', ref:
                  (await github.rest.repos.listTags({owner: 'GreycLab', repo: 'CImg', per_page: 1, page: 1})).data[0].name
              })
      - run: echo ${{ steps.get-cimg.outputs.result }} > 'src/CImg.h'
      - run: |
          if git diff --quiet; then
            echo "No changes detected. Exiting..."
            exit 0
          fi
      - run: |
          git config user.name 'GitHub Actions'
          git config user.email 'actions@github.com'
          git commit -am "Update CImg.h to the latest version"
          git push
